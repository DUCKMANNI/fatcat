


<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{shared/layout}">

<body>

	<div layout:fragment="content">


		<th:block th:unless="${isAuthenticated}">
			<script th:inline="javascript">
            /*<![CDATA[*/
            // 비로그인 시 로그인 페이지로 이동 (메시지 인코딩 처리 포함)
            const message = '마이페이지는 로그인을 해야 볼 수 있습니다. 로그인 후 이용해 주세요!';
            window.location.href = '/users/login?message=' + encodeURIComponent(message);
            /*]]>*/
        </script>
		</th:block>


		<th:block th:if="${isAuthenticated}">

			<style>

/* (기존 CSS) */
:root {
	--tan-color: #d7bfa5;
	--dark-tan-color: #8c735d;
	--light-tan-color: #ffffff;
	--border-color: #e6e6e6;
	--text-color: #555555;
	--font-size-body: 20px;
	--font-size-category: 25px;
}

.page-content-wrapper {
	display: flex;
	justify-content: center;
	padding: 40px 20px;
	background-color: var(--light-tan-color);
}

.mypage-container-new {
	width: 100%;
	max-width: 1000px;
	background-color: transparent;
	border: none;
	padding: 0;
	box-sizing: border-box;
}

.mypage-title {
	font-family: 'Juache', sans-serif;
	font-size: 2.8em;
	color: var(--dark-tan-color);
	margin-bottom: 20px;
	text-align: center;
}

.mypage-tabs {
	border-bottom: 2px solid var(--border-color);
	margin-bottom: 30px;
	display: flex;
	justify-content: center;
}

.mypage-tabs .nav-link {
	font-family: 'Juache', sans-serif;
	font-weight: normal;
	font-size: var(--font-size-category);
	padding: 15px 0;
	margin-right: 30px;
	color: var(--dark-tan-color);
	background-color: transparent !important;
	border: none !important;
	border-radius: 0 !important;
	text-decoration: none;
	transition: color 0.2s, border-bottom 0.2s;
}

.mypage-tabs .nav-link:hover {
	color: var(--tan-color);
	border-bottom: none;
}

.mypage-tabs .nav-link.active {
	color: var(--dark-tan-color);
	font-weight: bold;
	border-bottom: 4px solid var(--dark-tan-color) !important;
	background-color: transparent !important;
	box-shadow: none !important;
}

.tab-content {
	padding: 10px 0;
	font-size: var(--font-size-body);
}

.section h2 {
	font-size: 2em;
	color: var(--dark-tan-color);
	margin-bottom: 20px;
	border-bottom: 2px solid var(--border-color);
	padding-bottom: 10px;
}

.info-item, .cat-details p, .cat-details ul, .coupon-item p, .section p
	{
	font-size: var(--font-size-body);
}

.cat-info-section {
	display: flex;
	align-items: center;
	gap: 30px;
	padding: 20px;
	background-color: #f9f9f9;
	border-radius: 10px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
	margin-bottom: 20px;
}

.cat-details h3 {
	font-size: 1.5em;
	color: var(--dark-tan-color);
	margin-top: 0;
	margin-bottom: 10px;
}

.edit-button {
	font-size: var(--font-size-body);
	background-color: var(--dark-tan-color);
	color: white;
	padding: 14px 25px;
	border: none;
	border-radius: 30px;
	cursor: pointer;
	text-decoration: none;
	font-weight: bold;
	transition: background-color 0.3s, transform 0.2s;
	display: inline-block;
	margin-top: 0;
	margin-left: auto;
}

.order-list th, .order-list td {
	padding: 18px;
	border-bottom: none;
	font-size: var(--font-size-body);
}

.section {
	margin-bottom: 40px;
	padding: 0;
	background-color: transparent;
	border-radius: 0;
	box-shadow: none;
	transition: none;
}

.section:hover {
	transform: none;
}

.cat-info-section:last-child {
	margin-bottom: 0;
}

.profile-image-wrapper {
	flex-shrink: 0;
	width: 100px;
	height: 100px;
}

.profile-image {
	width: 100px;
	height: 100px;
	border-radius: 50%;
	object-fit: cover;
	border: 2px solid var(--tan-color);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	transition: transform 0.3s;
}

.profile-image:hover {
	transform: scale(1.05);
}

.cat-details {
	flex-grow: 1;
}

.info-list {
	list-style: none;
	padding: 0;
	margin: 0;
}

.info-item {
	margin-bottom: 8px;
	line-height: 1.6;
}

.info-item strong {
	display: inline-block;
	width: 100px;
	color: var(--dark-tan-color);
	font-weight: 600;
}

.coupon-item {
	padding: 15px;
	border: 1px dashed var(--tan-color);
	border-radius: 8px;
	background-color: #fff8f0;
	margin-bottom: 10px;
}

.coupon-item strong {
	color: var(--dark-tan-color);
	font-weight: 700;
}

/* -------------------------------------- */
/* 🚀 주문 내역 테이블 및 상세 정보 스타일 수정 */
/* -------------------------------------- */

.order-list table {
	width: 100%;
	border-collapse: separate;
	border-spacing: 0 15px;
	text-align: left;
}

/* <thead> 스타일 수정: 테이블 헤더를 가장 진한 색으로 변경하여 명확히 구분 */
.order-list th {
	padding: 18px;
	background-color: var(--dark-tan-color); /* ⭐️ 진한 탄색으로 변경 */
	color: #fff;
	font-weight: 700;
	border-bottom: none;
	font-size: var(--font-size-body);
}

/* <thead>의 첫 번째와 마지막 th에만 둥근 모서리 적용 */
.order-list thead tr th:first-child {
	border-top-left-radius: 10px;
}
.order-list thead tr th:last-child {
	border-top-right-radius: 10px;
}

/* <tbody>의 요약 행 스타일 */
.order-list tbody tr.order-summary-row {
	/* ⭐️ 배경색은 흰색을 유지하며, 둥근 모서리, 선명한 그림자, 테두리선을 추가하여 갈색 헤더 밑의 흰색이 배경과 구분이 되도록 함 */
	background-color: #fff;
	box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08); /* 그림자 더 선명하게 */
	border-radius: 10px; /* 둥근 모서리 */
	transition: transform 0.2s, box-shadow 0.2s;
	border: 1px solid var(--border-color); /* 경계선 추가 */
}

.order-list tbody tr.order-summary-row:hover {
	transform: translateY(-2px); /* 호버 효과 감소 */
	box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15); /* 호버 시 그림자 강조 */
	background-color: #fffff8; /* 아주 미세한 색상 변화 */
}

.order-list tbody tr.order-summary-row td {
    border: none; /* td 기본 border 제거 */
    padding: 18px;
}

/* 상세 보기 버튼 스타일 */
.detail-toggle-btn {
	font-size: 0.9em;
	padding: 8px 15px; /* 버튼 크기 키움 */
	background-color: var(--tan-color); /* ⭐️ 기본 탄색 */
	color: white;
	border: none;
	border-radius: 20px; /* 둥근 버튼 */
	cursor: pointer;
	font-weight: 600;
	transition: background-color 0.2s, transform 0.2s;
}

.detail-toggle-btn:hover {
	background-color: var(--dark-tan-color);
	transform: scale(1.02);
}

/* ⭐️ 버튼이 열려 있을 때 (활성화 상태) 스타일 변경 */
.detail-toggle-btn[aria-expanded="true"] {
    background-color: var(--dark-tan-color); /* 열렸을 때는 진한 색으로 바뀌어 구분 */
}

/* 주문 상세 내용이 펼쳐지는 영역 스타일 */
.order-detail-content {
	/* ⭐️ 배경색을 아주 밝은 베이지색으로 변경하여 경계를 명확히 */
	background-color: #fcf6f0; 
	border: 1px solid var(--tan-color); /* 테두리 색상 강조 */
	border-top: none; /* 위쪽 테두리는 요약 행과 붙으므로 제거 */
	border-bottom-left-radius: 10px;
	border-bottom-right-radius: 10px;
	margin-top: -15px; /* 요약 행과의 경계를 덮기 위해 음수 마진 적용 */
	overflow: hidden;
}

/* 상세 내용 내부 패딩 영역 스타일 (상품 목록, 배송 정보 등을 감싸는 div) */
.order-detail-content > div {
	background-color: #fcf6f0; 
	padding: 20px !important;
}

/* 📦 주문 상품 목록 스타일 */
.order-detail-content .order-item-list { 
	list-style: none;
	padding-left: 0;
	margin-bottom: 20px;
	font-size: 0.95em;
	border: 1px solid var(--tan-color); 
	border-radius: 8px;
	background-color: white; /* ⭐️ 상품 목록 박스는 흰색 배경으로 대비 */
	overflow: hidden;
	box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
}

.order-detail-content .order-item-list li {
	padding: 12px 18px;
	border-bottom: 1px solid #f0e6da; 
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.order-detail-content .order-item-list li:last-child {
	border-bottom: none;
}

/* 🚚 배송 정보 박스 스타일 추가 */
.detail-info-box {
    padding: 15px;
    background-color: var(--light-tan-color); /* 흰색 배경 */
    border: 1px dashed var(--tan-color); /* 점선 테두리 */
    border-radius: 8px;
    margin-top: 15px;
}

/* 요약 행 외의 tr 스타일 초기화 */
.order-list tbody tr:not(.order-summary-row) {
	box-shadow: none !important;
	transform: none !important;
	background-color: transparent !important; 
}
/* 🚀 CSS 수정 끝 */
</style>


			<div class="page-content-wrapper">
				<div class="mypage-container-new">


					<ul class="nav nav-tabs mypage-tabs" id="mypageTab" role="tablist">


						<li class="nav-item" role="presentation"><a
							class="nav-link active" id="info-tab" data-bs-toggle="tab"
							data-bs-target="#my-info" href="#" role="tab"
							aria-controls="my-info" aria-selected="true">내 정보</a></li>


						<li class="nav-item" role="presentation"><a class="nav-link"
							id="cat-tab" data-bs-toggle="tab" data-bs-target="#cat-info"
							href="#" role="tab" aria-controls="cat-info"
							aria-selected="false">고양이 정보</a></li>


						<li class="nav-item" role="presentation"><a class="nav-link"
							id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders"
							href="#" role="tab" aria-controls="orders" aria-selected="false">주문내역</a></li>


						<li class="nav-item" role="presentation"><a class="nav-link"
							id="coupon-tab" data-bs-toggle="tab" data-bs-target="#coupons"
							href="#" role="tab" aria-controls="coupons" aria-selected="false">내
								쿠폰함</a></li>


						<li class="nav-item" role="presentation"><a class="nav-link"
							id="cs-tab" data-bs-toggle="tab"
							data-bs-target="#customer-service" href="#" role="tab"
							aria-controls="customer-service" aria-selected="false">고객센터</a></li>
					</ul>

					<div class="tab-content" id="mypageTabContent">

						<div class="tab-pane fade show active" id="my-info"
							role="tabpanel" aria-labelledby="info-tab">
							<div class="section">
								<h2>내 정보</h2>
								<ul class="info-list" style="padding-left: 20px;">
									<li class="info-item"><strong>이름</strong>: <span
										th:text="${user?.userName ?: '정보 없음'}"></span></li>
									<li class="info-item"><strong>이메일</strong>: <span
										th:text="${user?.userEmail ?: '정보 없음'}"></span></li>
									<li class="info-item"><strong>연락처</strong>: <span
										th:text="${user?.phoneNumber ?: '정보 없음'}"></span></li>
									<li class="info-item"><strong>회원 등급</strong>: 냥집사</li>
								</ul>
								<a th:href="@{/users/modify}" class="btn btn-fatcat"
									style="font-size:25px;">정보 수정</a>
							</div>
						</div>

						<div class="tab-pane fade" id="cat-info" role="tabpanel"
							aria-labelledby="cat-tab">
							<div class="section">
								<h2>고양이 정보</h2>
								<div th:if="${cats != null and not #lists.isEmpty(cats)}">
									<div th:each="cat : ${cats}" class="cat-info-section">
										<div class="profile-image-wrapper">
											<img
												th:if="${cat?.catImageUrl != null and not #strings.isEmpty(cat?.catImageUrl)}"
												th:src="@{${cat.catImageUrl}}" class="profile-image"
												th:alt="${cat.catName} + ' 프로필 사진'"> <img
												th:unless="${cat?.catImageUrl != null and not #strings.isEmpty(cat?.catImageUrl)}"
												th:src="@{/images/default-cat.png}" class="profile-image"
												th:alt="${cat.catName} + ' 프로필 사진'">
										</div>

										<div class="cat-details">
											<h3 th:text="|🐱 ${cat?.catName ?: '미등록 고양이'}|">🐱 고양이
												이름</h3>
											<ul class="info-list">
												<li class="info-item"><strong>품종</strong>: <span
													th:text="${cat?.catBreed ?: '미등록'}"></span></li>
												<li class="info-item"><strong>출생일</strong>: <span
													th:text="${cat?.catBirtthday != null ? #temporals.format(cat.catBirtthday, 'yyyy년 MM월 dd일') : '미등록'}"></span></li>
												<li class="info-item"><strong>성별</strong>: <span
													th:text="${cat?.catGender ?: '미등록'}"></span></li>
											</ul>
										</div>

										<a th:href="@{|/cats/modify/${cat.catSeq}|}"
											class="btn btn-fatcat" style="font-size:25px;">정보 수정</a>
									</div>
								</div>
								<div th:unless="${cats != null and not #lists.isEmpty(cats)}">
									<p style="padding: 0 20px; font-style: italic; color: #888;">
										아직 등록된 고양이 정보가 없습니다. <a th:href="@{/cats/register}"
											style="color: var(--dark-tan-color); font-weight: bold;">새로
											등록</a>해 주세요!
									</p>
								</div>
							</div>
						</div>


						<div class="tab-pane fade" id="orders" role="tabpanel"
							aria-labelledby="orders-tab">
							<div class="section">
								<h2>주문내역</h2>

								<div class="order-list"
									th:if="${orderList != null and not #lists.isEmpty(orderList)}">
									<table>
										<thead>
											<tr>
												<th>주문 번호</th>
												<th>주문일</th>
												<th>총 금액</th>
												<th>상세 보기</th>
											</tr>
										</thead>
										<tbody>
											<th:block th:each="order : ${orderList}">
												<tr class="order-summary-row">
													<td th:text="${order.orderNumber}">1001</td>
													<td
														th:text="${order.orderDate != null ? #temporals.format(order.orderDate, 'yyyy-MM-dd') : '날짜 미확인'}"></td>

													<td
														th:text="${order.orderPrice != null ? #numbers.formatInteger(order.orderPrice, 0, 'COMMA') + '원' : '금액 미확인'}">55,000원</td>

													<td>
														<button class="btn btn-fatcat detail-toggle-btn" type="button"
															data-bs-toggle="collapse"
															th:attr="data-bs-target='#orderDetail-' + ${order.orderNumber}"
															aria-expanded="false"
															th:aria-controls="|orderDetail-${order.orderNumber}|">
															상세 보기</button>
													</td>
												</tr>

												<tr>
													<td colspan="4" class="p-0 border-0">
														<div th:id="|orderDetail-${order.orderNumber}|"
															class="collapse order-detail-content">
															<div class="p-4">

																<strong
																	style="display: block; margin-bottom: 5px; font-size: 1.1em; color: var(--dark-tan-color);">📦
																	주문 상품 목록</strong>

																<ul class="order-item-list">

																	<li th:each="item : ${order.orderItemList}">

																		<span
																		th:text="${item.product?.productName ?: '상품명 정보 없음'}"
																		style="font-weight: bold; color: var(--text-color);"></span> 
																		<span style="float: right;">
																			<span th:text="|${item.productQuantity}개|" style="color: var(--dark-tan-color); font-weight: 600;"></span>
																			/ <span
																			th:text="${#numbers.formatInteger(item.totalPrice, 0, 'COMMA')} + '원'"
																			style="color: var(--dark-tan-color); font-weight: 700;"></span>
																	</span>
																	</li>

																	<li th:if="${order.orderItemList == null or #lists.isEmpty(order.orderItemList)}" style="color: #888; text-align: center;">
																		주문된 상품 정보가 없습니다.
																	</li>

																</ul>
																
																<div class="detail-info-box">
                                                                    
                                                                    <strong style="display: block; margin-bottom: 10px; font-size: 1.1em; color: var(--dark-tan-color);">🚚 배송 정보</strong>

                                                                    <p style="margin-bottom: 5px; font-size: 0.95em;">
                                                                        <strong>수령인:</strong> <span
                                                                            th:text="${order.orderName}"></span>
                                                                    </p>
                                                                    <p style="margin-bottom: 5px; font-size: 0.95em;">
                                                                        <strong>연락처:</strong> <span
                                                                            th:text="${user?.phoneNumber ?: '정보 없음'}"></span>
                                                                    </p>
                                                                    <p style="margin-bottom: 5px; font-size: 0.95em;">
                                                                        <strong>배송지:</strong> <span
                                                                            th:text="${order.orderAddress1} + ' ' + ${order.orderAddress2}"></span>
                                                                    </p>
                                                                    <p style="margin-bottom: 0; font-size: 0.95em;">
                                                                        <strong>요청사항:</strong> <span
                                                                            th:text="${order.orderRequest ?: '없음'}"></span>
                                                                    </p>
                                                                </div>
															</div>
														</div>
													</td>
												</tr>
											</th:block>
										</tbody>
									</table>
								</div>
								<div
									th:unless="${orderList != null and not #lists.isEmpty(orderList)}">
									<p style="padding: 0 20px; font-style: italic; color: #888;">주문
										내역이 없습니다.</p>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="coupons" role="tabpanel"
							aria-labelledby="coupon-tab">
							<div class="section">
								<h2>내 쿠폰함</h2>
								<div style="padding: 0 20px;">
									<div class="coupon-item">
										<p>
											<strong>🎁 10% 할인 쿠폰</strong> - 유효기간: ~2025.12.31
										</p>
									</div>
									<div class="coupon-item">
										<p>
											<strong>🚚 무료배송 쿠폰</strong> - 유효기간: ~2025.10.31
										</p>
									</div>
									<p style="margin-top: 20px;">보유하신 쿠폰을 확인하고 쇼핑에 사용하세요.</p>
									<a href="#" class="btn btn-fatcat" style="font-size:25px;">쿠폰
										등록/사용</a>
								</div>
							</div>
						</div>

						<div class="tab-pane fade" id="customer-service" role="tabpanel"
							aria-labelledby="cs-tab">
							<div class="section">
								<h2>고객센터</h2>
								<div style="padding: 0 20px;">
									<p>자주 묻는 질문(FAQ)을 확인하고 싶으시면 아래 링크를 클릭해주세요.</p>
									<a th:href="@{/faq/list}" class="btn btn-fatcat" style="font-size:25px;">FAQ 보러가기</a>
									<p style="margin-top: 15px;">기타 문의사항은 고객센터(1588-XXXX)로 연락
										바랍니다.</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function() {
        const tabLinks = document.querySelectorAll('.mypage-tabs .nav-link');
        const tabContents = document.querySelectorAll('.tab-content .tab-pane');

        // 탭 버튼 클릭 리스너 등록
        tabLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // <--- 핵심: 기본 앵커 이동 동작 방지

                // 1. 모든 탭 버튼과 내용을 비활성화
                tabLinks.forEach(l => {
                    l.classList.remove('active');
                    l.setAttribute('aria-selected', 'false');
                });
                tabContents.forEach(c => {
                    c.classList.remove('show', 'active');
                });

                // 2. 현재 클릭된 버튼을 활성화
                this.classList.add('active');
                this.setAttribute('aria-selected', 'true');

                // 3. 연결된 탭 내용(target)을 활성화
                const targetId = this.getAttribute('data-bs-target');
                const targetPane = document.querySelector(targetId);
                
                if (targetPane) {
                    targetPane.classList.add('show', 'active');
                }

                // 4. URL 해시 업데이트 (새로고침 시 현재 탭 유지)
                window.history.pushState(null, null, targetId);
            });
        });

        // 페이지 로드 시 URL 해시(#탭ID)에 따라 탭 활성화 로직 (생략 가능하지만 유지 권장)
        const hash = window.location.hash;
        if (hash) {
            const triggerEl = document.querySelector(`.mypage-tabs a[data-bs-target="${hash}"]`);
            
            if (triggerEl) {
                // 기존 '내 정보' 활성화 클래스 제거
                const initialActiveLink = document.querySelector('#info-tab.active');
                const initialActivePane = document.querySelector('#my-info.show.active');
                
                if(initialActiveLink) {
                    initialActiveLink.classList.remove('active');
                    initialActiveLink.setAttribute('aria-selected', 'false');
                }
                if(initialActivePane) {
                    initialActivePane.classList.remove('show', 'active');
                }
                
                // 타겟 탭 활성화
                triggerEl.classList.add('active');
                triggerEl.setAttribute('aria-selected', 'true');
                document.querySelector(hash).classList.add('show', 'active');

                window.history.replaceState(null, null, hash);
            }
        }
    });
    /*]]>*/ 
</script>
		</th:block>
	</div>

</body>
</html>
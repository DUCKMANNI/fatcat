<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{shared/layout}">
<head>
<meta charset="UTF-8">
<title th:text="${mode == 'signup'} ? 'íšŒì›ê°€ì…' : 'íšŒì›ì •ë³´ ìˆ˜ì •'"></title>
<style>
/* ğŸš¨ ì˜¤ë¥˜ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ (ì˜ˆì‹œ) - CSS íŒŒì¼ì— í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥ */
.error-message {
    color: red;
    font-size: 0.9em;
    margin-top: -10px; /* ì…ë ¥ í•„ë“œì™€ì˜ ê°„ê²© ì¡°ì • */
    margin-bottom: 10px;
    text-align: left;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}
/* í¼ ì „ì²´ ì˜¤ë¥˜ ìŠ¤íƒ€ì¼ (ì˜ˆì‹œ) */
.form-global-error {
    color: white;
    background-color: #dc3545;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 20px;
    text-align: center;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}
</style>
</head>
<body>

	<div layout:fragment="content" class="custom-container"
		style="text-align: center; padding: 40px 0;">
		<h1 style="font-family: 'BagelFat', sans-serif; font-size: 60px; color: #CD853F; margin-bottom: 30px;"
        th:text="${mode == 'signup'} ? 'íšŒì›ê°€ì…' : 'íšŒì›ì •ë³´ ìˆ˜ì •'"></h1>

		<form  th:action="${mode == 'signup'} ? @{/users/signup} : @{/users/edit}" method="post" th:object="${SignupDTO}" enctype="multipart/form-data" style="max-width: 600px; margin: 0 auto;">
				
			<div th:replace="~{shared/form_errors :: formErrorsFragment}"></div>
            
			<input type="email" th:field="*{userEmail}" class="login-input" placeholder="E-mail (ì•„ì´ë””)" th:readonly="${mode == 'update'}" required>
			  <div th:if="${#fields.hasErrors('userEmail')}" th:errors="*{userEmail}" class="error-message"></div>
              
		      <div th:if="${mode == 'signup'}">
                <input type="password" th:field="*{userPassword}" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
				<div th:if="${#fields.hasErrors('userPassword')}" th:errors="*{userPassword}" class="error-message"></div>

                <input type="password" name="passwordConfirm" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
                </div>
            <div th:if="${mode == 'update'}">
                <input type="password" name="currentPassword" class="login-input" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸">
                <input type="password" name="newPassword" class="login-input" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
                <input type="password" name="confirmPassword" class="login-input" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            </div>
        
		      <input type="text" th:field="*{userName}" class="login-input" placeholder="ì´ë¦„" required>
			  <div th:if="${#fields.hasErrors('userName')}" th:errors="*{userName}" class="error-message"></div>

		      <input type="text" th:field="*{nickname}" class="login-input" placeholder="ë‹‰ë„¤ì„" required>
			  <div th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}" class="error-message"></div>
              
		      <input type="text" th:field="*{phoneNumber}" class="login-input" placeholder="íœ´ëŒ€í° ë²ˆí˜¸" required>
			  <div th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}" class="error-message"></div>

			<div class="address-group">
				 <input type="text" id="zipCode" th:field="*{zipCode}" class="login-input" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
				 <button type="button" onclick="execDaumPostcode()" class="btn-fatcat">ì£¼ì†Œ ê²€ìƒ‰</button>
			  </div>
			  <div th:if="${#fields.hasErrors('zipCode')}" th:errors="*{zipCode}" class="error-message"></div>

		      <input type="text" id="address1" th:field="*{address1}" class="login-input" placeholder="ê¸°ë³¸ ì£¼ì†Œ" readonly>
			  <div th:if="${#fields.hasErrors('address1')}" th:errors="*{address1}" class="error-message"></div>

	        <input type="text" id="address2" th:field="*{address2}" class="login-input" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥">
	        <input type="hidden" id="latitude" th:field="*{latitude}">
	        <input type="hidden" id="longitude" th:field="*{longitude}">
			<div th:if="${#fields.hasErrors('latitude')}" th:errors="*{latitude}" class="error-message"></div>
			<div th:if="${#fields.hasErrors('longitude')}" th:errors="*{longitude}" class="error-message"></div>
				
			<div class="file-input-row">
			  <label for="profileImage">í”„ë¡œí•„ ì´ë¯¸ì§€ (ì„ íƒ)</label>
			  <div class="file-input-wrapper">
			    <label for="profileImage" class="custom-file-label">íŒŒì¼ ì„ íƒ</label>
			    <span id="fileName" class="file-name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
			    <div id="profileThumb" class="profile-thumb"></div>
			    <input type="file" id="profileImage" name="profileImageFile" accept="image/*" onchange="previewInline(this)">
			  </div>
			</div>


		      <div class="file-input-row">
			  <label for="vetLicenseImage">ìˆ˜ì˜ì‚¬ ë©´í—ˆ ì´ë¯¸ì§€ (ì„ íƒ)</label>
			  <div class="file-input-wrapper">
			    <label for="vetLicenseImage" class="custom-file-label">íŒŒì¼ ì„ íƒ</label>
			    <span id="vetFileName" class="file-name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
			    <input type="file" id="vetLicenseImage" name="vetLicenseImageFile" accept="image/*" onchange="showFileName(this, 'vetFileName')">
			  </div>
			</div>


			<button type="submit" class="login-btn mt-4"
                th:text="${mode == 'signup'} ? 'ê°€ì…í•˜ê¸°' : 'ìˆ˜ì •í•˜ê¸°'"></button>
    </form>
		
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4c15890a040537b9e018efed80761b21&libraries=services"></script>
<script>


function execDaumPostcode() {
	console.log("execDaumPostcode ì‹¤í–‰ë¨ âœ…");
	  new daum.Postcode({

	    oncomplete: function(data) {
	    	
	    	console.log("oncomplete ì‹¤í–‰ë¨ âœ…", data);
	      // âœ… ê¸°ë³¸ì£¼ì†Œ & ìš°í¸ë²ˆí˜¸ ì±„ìš°ê¸°
	      document.getElementById('address1').value = data.roadAddress;
	      document.getElementById('zipCode').value = data.zonecode;
	      
	      console.log("ë„ë¡œëª…ì£¼ì†Œ:", data.roadAddress);

	      try {
	        // âœ… ì¢Œí‘œ ë³€í™˜ (ì—ëŸ¬ ë‚˜ë„ íŒì—…ì€ ë‹«íˆê²Œ)
	        var geocoder = new kakao.maps.services.Geocoder();
	        geocoder.addressSearch(data.roadAddress, function(result, status) {
	        	console.log("status:", status, "result:", result);
	          if (status === kakao.maps.services.Status.OK) {
	        	  console.log("ë³€í™˜ ì„±ê³µ:", result[0]);
	            document.getElementById('latitude').value = result[0].y;
	            document.getElementById('longitude').value = result[0].x;
	          }
	        });
	      } catch (e) {
	        console.error("Geocoder ì—ëŸ¬:", e);
	      }
	    } 
	  }).open(); // ğŸ‘‰ íŒì—…ìœ¼ë¡œ ì—´ê¸°
	}
	
function previewInline(input) {
	  const fileName = document.getElementById('fileName');
	  const thumb = document.getElementById('profileThumb');
	  thumb.innerHTML = "";

	  if (input.files && input.files[0]) {
	    fileName.textContent = input.files[0].name; // íŒŒì¼ëª… í‘œì‹œ
	    const reader = new FileReader();
	    reader.onload = function(e) {
	      const img = document.createElement("img");
	      img.src = e.target.result;
	      thumb.appendChild(img);
	      thumb.style.display = "block";
	    };
	    reader.readAsDataURL(input.files[0]);
	  } else {
	    fileName.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
	    thumb.style.display = "none";
	  }
	}
	
function showFileName(input, targetId) {
	  const fileName = document.getElementById(targetId);

	  if (input.files && input.files[0]) {
	    fileName.textContent = input.files[0].name; // íŒŒì¼ëª… í‘œì‹œ
	  } else {
	    fileName.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
	  }
	}

</script>


		
	</div>
	
	
</body>


</html>